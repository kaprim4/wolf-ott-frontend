<mat-card class="cardWithShadow theme-card">
    <ng-container *ngIf="isLoading">
        <mat-progress-bar mode="query"></mat-progress-bar>
    </ng-container>
    <mat-card-header>
        <mat-card-title class="m-b-0" style="color:white;">
            Quick Xtream
        </mat-card-title>
    </mat-card-header>
    <mat-card-content class="b-t-1">
        <mat-stepper #stepper>
            <mat-step [stepControl]="packageForm">
                <form class="mt-3" [formGroup]="packageForm"> <!-- Use Bootstrap's margin-top -->
                    <ng-template matStepLabel>Package</ng-template>
                    <div>
                        <mat-form-field appearance="outline" class="w-100 m-4">
                            <mat-label class="mat-subtitle-2 fw-bold">Package</mat-label>
                            <mat-select formControlName="package" (selectionChange)="onSelectPackage($event)"
                                        (openedChange)="onPackagesDropdownOpened($event)" required>
                                <mat-select-trigger>
                                    {{ getSelectedPackageName() }}
                                </mat-select-trigger>
                                <mat-option>
                                    <ngx-mat-select-search
                                        [formControl]="packageSearchCtrl"
                                        placeholderLabel="Search"
                                        noEntriesFoundLabel="No options found">
                                    </ngx-mat-select-search>
                                </mat-option>
                                <mat-option *ngFor="let pkg of filteredPackages" [value]="pkg.id"
                                            (click)="$event.stopPropagation()">
                                    {{ pkg.packageName }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                        <div class="d-flex justify-content-between p-8 m-b-20">
                            <div class="d-flex align-items-start">
                                <mat-label class="mat-subtitle-2 f-w-600">Use WolfGuard</mat-label>
                            </div>
                            <div class="align-items-end">
                                <mat-slide-toggle formControlName="use_vpn" color="primary"></mat-slide-toggle>
                            </div>
                        </div>
                        <div class="d-flex align-items-center justify-content-between">
                            <button mat-flat-button color="warn" matStepperPrevious>Back</button>
                            <button mat-flat-button color="primary" matStepperNext>Next</button>
                        </div>
                    </div>
                </form>
            </mat-step>
            <mat-step [stepControl]="bundleForm">
                <form class="" [formGroup]="bundleForm">
                    <ng-template matStepLabel>Bundle</ng-template>
                    <div class="row d-flex flex-column justify-content-start align-items-start p-24">
                        <div class="m-l-4">
                            <span class="d-block text-light">Select Bundle:</span>
                            <mat-radio-group formControlName="bundle" (change)="bundleToggle($event)">
                                <mat-radio-button value="packages" [checked]="selectedBundleOption === 'packages'">
                                    All (bouquets)
                                </mat-radio-button>
                                <mat-radio-button value="presets" [checked]="selectedBundleOption === 'presets'">
                                    Presets
                                </mat-radio-button>
                            </mat-radio-group>
                        </div>

                        <ng-container [ngSwitch]="bundleForm.value.bundle">
                            <ng-container *ngSwitchCase="'packages'">
                                <mat-form-field appearance="outline" class="w-100 m-r-24">
                                    <mat-select formControlName="package" (selectionChange)="onSelectPackage($event)">
                                        <mat-select-trigger>
                                            {{ selectedPackage?.packageName || 'Select Package' }}
                                        </mat-select-trigger>
                                        <mat-option *ngFor="let pkg of packages" [value]="pkg.id"
                                                    (click)="$event.stopPropagation()">
                                            {{ pkg.packageName }}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </ng-container>
                            <ng-container *ngSwitchCase="'presets'">
                                <mat-form-field appearance="outline" class="w-100 m-r-24">
                                    <mat-select [(ngModel)]="selectedPresetId"
                                                (selectionChange)="onSelectPreset($event)">
                                        <mat-select-trigger>
                                            {{ getSelectedPresetName() || 'Select Preset' }}
                                        </mat-select-trigger>
                                        <mat-option *ngFor="let preset of presets" [value]="preset.id"
                                                    (click)="$event.stopPropagation()">
                                            {{ preset.presetName }}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </ng-container>
                        </ng-container>
                    </div>
                    <div class="d-flex align-items-center justify-content-between">
                        <button mat-flat-button color="warn" matStepperPrevious>Back</button>
                        <button mat-flat-button color="primary" matStepperNext (click)="createLine()">
                            Create Line
                        </button>
                    </div>
                </form>
            </mat-step>
            <mat-step>
                <ng-template matStepLabel>Finish</ng-template>
                <div class="input-group p-10">
                    <mat-form-field appearance="outline" class="w-100 m-t-2">
                        <mat-label>Host</mat-label>
                        <input matInput type="text" [value]="server" disabled>
                    </mat-form-field>
                </div>
                <div class="input-group p-10">
                    <mat-form-field appearance="outline" class="w-100 m-t-2">
                        <mat-label>Username</mat-label>
                        <input matInput type="text" [value]="username" disabled>
                    </mat-form-field>
                </div>
                <div class="input-group p-10">
                    <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Password</mat-label>
                        <input matInput type="text" [value]="password" disabled>
                    </mat-form-field>
                </div>
                <div class="d-flex align-items-center justify-content-between">
                    <button class="action-btn" mat-icon-button matStepperNext (click)="copyToClipboard()">
                        <mat-icon>content_copy</mat-icon>
                    </button>
                </div>
            </mat-step>
        </mat-stepper>
    </mat-card-content>
</mat-card>
