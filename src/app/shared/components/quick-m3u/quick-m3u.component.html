<mat-card class="cardWithShadow theme-card">
    @if (isLoading) {
        <mat-progress-bar mode="query"></mat-progress-bar>
    }
    <mat-card-header>
        <mat-card-title class="m-b-0" style="color:white;">
            Quick M3U
        </mat-card-title>
    </mat-card-header>
    <mat-card-content class="b-t-1">
        @if (lineCreated) {
            <div class="input-group">
                <mat-form-field appearance="outline" class="w-100" color="primary">
                    <mat-label>Playlist URL</mat-label>
                    <input matInput type="text" [value]="downloadUrl" disabled>
                </mat-form-field>
                <button class="action-btn" mat-icon-button (click)="copyToClipboard(downloadUrl)">
                    <mat-icon>content_copy</mat-icon>
                </button>
                <button class="action-btn" mat-icon-button (click)="downloadM3U(downloadUrl)">
                    <mat-icon>download</mat-icon>
                </button>
            </div>
        } @else {
            <div>
                <input type="hidden" [(ngModel)]="username" />
                <input type="hidden" [(ngModel)]="password" />

                <div class="row d-flex justify-content-between align-items-center p-24">
                    <div class="m-l-24">
                        <span class="d-block">Select Bundle:</span>
                        <mat-radio-group [(ngModel)]="selectedBundleOption" (change)="bundleToggle($event)">
                            <mat-radio-button value="packages" [checked]="selectedBundleOption == 'packages'">Package's bouquets</mat-radio-button>
                            <mat-radio-button value="presets" [checked]="selectedBundleOption == 'presets'">Custom preset's bouquets</mat-radio-button>
                        </mat-radio-group>
                    </div>

                    @switch (selectedBundleOption) {
                        @case ('packages') {
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label class="mat-subtitle-2 f-w-600">Package</mat-label>
                                <mat-select [(ngModel)]="selectedPackage" (openedChange)="onPackagesDropdownOpened($event)" required>
                                    <mat-select-trigger>
                                        {{ selectedPackage ? selectedPackage.packageName : 'Select a package' }}
                                    </mat-select-trigger>
                                    <mat-option>
                                        <ngx-mat-select-search
                                            [formControl]="packageSearchCtrl"
                                            placeholderLabel="Search"
                                            noEntriesFoundLabel="No options found">
                                        </ngx-mat-select-search>
                                    </mat-option>
                                    <mat-option *ngFor="let pkg of filteredPackages" [value]="pkg" (click)="$event.stopPropagation()">
                                        {{ pkg.packageName }}
                                    </mat-option>
                                </mat-select>
                                <mat-error *ngIf="!selectedPackage">Please select a package.</mat-error>
                            </mat-form-field>
                        }
                        @case ('presets') {
                            <mat-form-field appearance="outline" class="w-40 m-r-24">
                                <mat-select [(ngModel)]="selectedPreset" (ngModelChange)="onSelectPreset($event)">
                                    <mat-select-trigger>
                                        {{ getSelectedPresetName() }}
                                    </mat-select-trigger>
                                    @for (preset of presets; track preset) {
                                        <mat-option [value]="preset.id" (click)="$event.stopPropagation()">
                                            {{ preset.presetName }}
                                        </mat-option>
                                    }
                                </mat-select>
                            </mat-form-field>
                        }
                    }
                </div>

                <button mat-raised-button color="primary" class="w-100 f-s-15 f-w-800" (click)="createLine()" [disabled]="canCreate">
                    Generate M3U
                </button>
            </div>
        }
    </mat-card-content>
</mat-card>
