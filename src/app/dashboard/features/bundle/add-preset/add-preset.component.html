<mat-card class="cardWithShadow theme-card">
  @if(loading){
    <mat-progress-bar mode="query"></mat-progress-bar>
  }
  <mat-card-header>
      <div class="w-100 d-flex justify-content-between align-items-center">
        <h4 class="mat-subtitle-2 f-s-18 f-w-600 m-b-0">
          <mat-card-title>Add Preset</mat-card-title>
        </h4>
        <div class="text-right">
          <a routerLink="/apps/bundles/presets/list" mat-stroked-button olor="warn" class="m-r-10">Cancel</a>
          <button mat-raised-button color="primary" (click)="$event.preventDefault(); saveDetail()" [disabled]="addForm.invalid || this.loading || !isFinishStep">
            Save Preset
          </button>
        </div>
      </div>
    </mat-card-header>
    
    <mat-card-content class="b-t-1">
      <mat-stepper #stepper (selectionChange)="onStepChange($event)">
        <mat-step [stepControl]="addForm">
          <ng-template matStepLabel>Details</ng-template>
          <form [formGroup]="addForm" (ngSubmit)="saveDetail()">
            <div class="row">
              <div class="col-sm-4 d-flex align-items-center">
                <mat-label class="mat-subtitle-2 f-w-600 d-block m-b-16">Preset Name</mat-label>
              </div>
              <div class="col-sm-8">
                <mat-form-field appearance="outline" class="w-100">
                  <input matInput placeholder="Preset Name" name="presetName" formControlName="name" required />
                </mat-form-field>
              </div>
            </div>

            <div class="row">
              <div class="col-sm-4 d-flex align-items-center">
                <mat-label class="mat-subtitle-2 f-w-600 d-block m-b-16">Preset Description</mat-label>
              </div>
              <div class="col-sm-8">
                <mat-form-field appearance="outline" class="w-100">
                  <input matInput placeholder="Preset Description" name="presetDescription" formControlName="description" required />
                </mat-form-field>
              </div>
            </div>
          </form>
          <div class="d-flex align-items-center justify-content-end">
            <button mat-flat-button color="primary" matStepperNext>Next</button>
        </div>
        </mat-step>

        <mat-step>
          <ng-template matStepLabel>Bouquets</ng-template>
          <div class="d-flex g-4 p-4">
            <!-- Left Side: Package Bouquets Table -->
            <div class="mr-4" style="flex-basis: 50%; max-width: 50%;">
              <mat-card class="mx-4 cardWithShadow theme-card">
                <mat-card-header>
                  <mat-card-title>Packages Bouquets</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <div class="table-responsive">
                    <table mat-table [dataSource]="packageBouquetsDataSource" class="w-100">
                      <ng-container matColumnDef="select">
                        <th mat-header-cell *matHeaderCellDef class="p-l-0">
                          <mat-checkbox (change)="$event ? masterTogglePackage() : null" [checked]="bouquetsSelection.hasValue() && isAllSelectedPackage()" [indeterminate]="bouquetsSelection.hasValue() && !isAllSelectedPackage()"></mat-checkbox>
                        </th>
                        <td mat-cell *matCellDef="let row" class="p-l-0">
                          <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? bouquetsSelection.toggle(row) : null"
                            color="primary" [checked]="bouquetsSelection.isSelected(row)" [aria-label]="checkboxLabel(row)">
                          </mat-checkbox>
                        </td>
                      </ng-container>
        
                      <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Bouquet Name
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          {{ element.bouquetName }}
                        </td>
                      </ng-container>
        
                      <ng-container matColumnDef="content">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Content
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          {{ element.stations + element.streams }}
                        </td>
                      </ng-container>
        
                      <tr mat-header-row *matHeaderRowDef="packageBouquetsDisplayedColumns"></tr>
                      <tr mat-row *matRowDef="let row; columns: packageBouquetsDisplayedColumns"></tr>
                    </table>
                    <mat-paginator #packagePaginator [pageSizeOptions]="[5, 10, 25]" pageSize="5" showFirstLastButtons></mat-paginator>                    
                  </div>
                </mat-card-content>
              </mat-card>
            </div>
            <!-- Right Side: VOD Bouquets Table -->
            <div class="ml-4" style="flex-basis: 50%; max-width: 50%;">
              <mat-card class="mx-4 cardWithShadow theme-card">
                <mat-card-header>
                  <mat-card-title>VOD Bouquets</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <div class="table-responsive">
                    <table mat-table [dataSource]="vodBouquetsDataSource" class="w-100">
                      <ng-container matColumnDef="select">
                        <th mat-header-cell *matHeaderCellDef class="p-l-0">
                          <!-- <mat-checkbox (change)="$event ? masterToggleVOD() : null" [checked]="bouquetsSelection.hasValue() && isAllSelectedVOD()"[indeterminate]="bouquetsSelection.hasValue() && !isAllSelectedVOD()"></mat-checkbox>             -->
                          <mat-checkbox (change)="$event ? masterToggleVOD() : null" [checked]="bouquetsSelection.hasValue() && isAllSelectedVOD()" [indeterminate]="bouquetsSelection.hasValue() && !isAllSelectedVOD()"></mat-checkbox>
                        </th>
                        <td mat-cell *matCellDef="let row" class="p-l-0">
                          <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? bouquetsSelection.toggle(row) : null"
                            color="primary" [checked]="bouquetsSelection.isSelected(row)" [aria-label]="checkboxLabel(row)">
                          </mat-checkbox>
                        </td>
                      </ng-container>
        
                      <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Bouquet Name
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          {{ element.bouquetName }}
                        </td>
                      </ng-container>
        
                      <ng-container matColumnDef="content">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Content
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          {{ element.movies + element.series }}
                        </td>
                      </ng-container>
        
                      <tr mat-header-row *matHeaderRowDef="vodBouquetsDisplayedColumns"></tr>
                      <tr mat-row *matRowDef="let row; columns: vodBouquetsDisplayedColumns"></tr>
                    </table>
                    <mat-paginator #vodPaginator [pageSizeOptions]="[5, 10, 25]" pageSize="5" showFirstLastButtons></mat-paginator>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>
          </div>

          <div class="d-flex align-items-center justify-content-between">
            <button mat-flat-button color="warn" matStepperPrevious>Back</button>
            <button mat-flat-button color="primary" matStepperNext>Next</button>
        </div>
        </mat-step>
        
        <mat-step>
          <ng-template matStepLabel>Finish</ng-template>
        
          <div class="summary-container">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Preset Name</mat-label>
              <input matInput [value]="addForm.controls['name'].value" disabled>
            </mat-form-field>
        
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Preset Description</mat-label>
              <input matInput [value]="addForm.controls['description'].value" disabled>
            </mat-form-field>
        
            <div class="summary-section">
              <b>Streams: </b>
              <span>{{ getTotalStreamBouquets() }} Bouquets Selected with ({{ getTotalStreams() }}) Streams</span>
              <br>
              <b>Movies: </b>
              <span>{{ getTotalMovieBouquets() }} Bouquets Selected with ({{ getTotalMovies() }}) Movies</span>
              <br>
              <b>Series: </b>
              <span>{{ getTotalSeriesBouquets() }} Bouquets Selected with ({{ getTotalSeries() }}) Series</span>
              <br>
              <b>Stations: </b>
              <span>{{ getTotalStationBouquets() }} Bouquets Selected with ({{ getTotalStations() }}) Stations</span>
            </div>
        
            <!-- Draggable List of Selected Bouquets -->
            <div
              class="selected-bouquets-container"
              cdkDropList
              [cdkDropListData]="bouquetsSelection.selected"
              (cdkDropListDropped)="onBouquetDrop($event)"
            >
              <h4>Selected Bouquets </h4>
        
              <div
                *ngFor="let bouquet of bouquetsSelection.selected"
                class="bouquet-item"
                cdkDrag
                [cdkDragData]="bouquet"
              >
                <div class="bouquet-item-content">
                  <mat-icon class="bouquet-drag-cursor">reorder</mat-icon>
                  <span>{{ bouquet.bouquetName }}</span>
                </div>
              </div>
            </div>
          </div>
        </mat-step>
        
        <div class="d-flex align-items-center justify-content-between">
          <button mat-flat-button color="warn" matStepperPrevious>Back</button>
      </div>
      </mat-stepper>
    </mat-card-content>

  
  
</mat-card>
