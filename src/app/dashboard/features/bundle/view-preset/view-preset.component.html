<mat-card class="cardWithShadow theme-card">
  @if(loading){
    <mat-progress-bar mode="query"></mat-progress-bar>
  }
  <mat-card-header>
      <div class="w-100 d-flex justify-content-between align-items-center">
        <h4 class="mat-subtitle-2 f-s-18 f-w-600 m-b-0">
          <mat-card-title>Edit Preset</mat-card-title>
        </h4>
        <div class="text-right">
          <a routerLink="/apps/bundles/presets/list" mat-stroked-button olor="warn" class="m-r-10">Cancel</a>
          <button mat-raised-button color="primary" (click)="$event.preventDefault(); saveDetail()" [disabled]="editForm.invalid || this.loading || !isFinishStep">
            Save Preset
          </button>
        </div>
      </div>
    </mat-card-header>
    
    <mat-card-content class="b-t-1">
      <mat-stepper #stepper>
        <mat-step [stepControl]="editForm" (selectionChange)="onStepChange($event)">
          <ng-template matStepLabel>Details</ng-template>
          <form [formGroup]="editForm" (ngSubmit)="saveDetail()">
            <div class="row">
              <div class="col-sm-4 d-flex align-items-center">
                <mat-label class="mat-subtitle-2 f-w-600 d-block m-b-16">Preset Name</mat-label>
              </div>
              <div class="col-sm-8">
                <mat-form-field appearance="outline" class="w-100">
                  <input matInput placeholder="Preset Name" name="presetName" formControlName="name" required />
                </mat-form-field>
              </div>
            </div>

            <div class="row">
              <div class="col-sm-4 d-flex align-items-center">
                <mat-label class="mat-subtitle-2 f-w-600 d-block m-b-16">Preset Description</mat-label>
              </div>
              <div class="col-sm-8">
                <mat-form-field appearance="outline" class="w-100">
                  <input matInput placeholder="Preset Description" name="presetDescription" formControlName="description" required />
                </mat-form-field>
              </div>
            </div>
          </form>
        </mat-step>

        <mat-step (selectionChange)="onStepChange($event)">
          <ng-template matStepLabel>Bouquets</ng-template>
          <div class="d-flex">
            <!-- Left Side: Tab Group -->
            <div class="flex-grow-1">
              <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start" animationDuration="300ms">
                <mat-tab label="Streams">
                  <mat-card-content class="b-t-1">
                    <div class="table-responsive">
                      <table mat-table [dataSource]="getStreamsBouquetsDatasource" class="w-100">
                        <!-- Table Columns -->
                        <ng-container matColumnDef="select">
                          <th mat-header-cell *matHeaderCellDef class="p-l-0">
                            <mat-checkbox (change)="$event ? masterToggle() : null" [checked]="bouquetsSelection.hasValue() && isAllSelected()"
                              color="primary" [indeterminate]="bouquetsSelection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
                            </mat-checkbox>
                          </th>
                          <td mat-cell *matCellDef="let row" class="p-l-0">
                            <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? bouquetsSelection.toggle(row) : null"
                              color="primary" [checked]="bouquetsSelection.isSelected(row)" [aria-label]="checkboxLabel(row)">
                            </mat-checkbox>
                          </td>
                        </ng-container>
        
                        <ng-container matColumnDef="name">
                          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                            Bouquet Name
                          </th>
                          <td mat-cell *matCellDef="let element" class="mat-body-1">
                            {{ element.bouquetName }}
                          </td>
                        </ng-container>
        
                        <ng-container matColumnDef="streams">
                          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                            Streams
                          </th>
                          <td mat-cell *matCellDef="let element" class="mat-body-1">
                            {{ element.streams }}
                          </td>
                        </ng-container>
        
                        <tr mat-header-row *matHeaderRowDef="streamsBouquetsDisplayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: streamsBouquetsDisplayedColumns" (click)="bouquetsSelection.toggle(row)"></tr>
                      </table>
                    </div>
                  </mat-card-content>
                </mat-tab>
                <mat-tab label="Movies">
                  <mat-card-content class="b-t-1">
                    <div class="table-responsive">
                      <table mat-table [dataSource]="getMoviesBouquetsDatasource" class="w-100">
                        <!-- Table Columns -->
                        <ng-container matColumnDef="select">
                          <th mat-header-cell *matHeaderCellDef class="p-l-0">
                            <mat-checkbox (change)="$event ? masterToggle() : null" [checked]="bouquetsSelection.hasValue() && isAllSelected()"
                              color="primary" [indeterminate]="bouquetsSelection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
                            </mat-checkbox>
                          </th>
                          <td mat-cell *matCellDef="let row" class="p-l-0">
                            <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? bouquetsSelection.toggle(row) : null"
                              color="primary" [checked]="bouquetsSelection.isSelected(row)" [aria-label]="checkboxLabel(row)">
                            </mat-checkbox>
                          </td>
                        </ng-container>
        
                        <ng-container matColumnDef="name">
                          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                            Bouquet Name
                          </th>
                          <td mat-cell *matCellDef="let element" class="mat-body-1">
                            {{ element.bouquetName }}
                          </td>
                        </ng-container>
        
                        <ng-container matColumnDef="movies">
                          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                            Movies
                          </th>
                          <td mat-cell *matCellDef="let element" class="mat-body-1">
                            {{ element.movies }}
                          </td>
                        </ng-container>
        
                        <tr mat-header-row *matHeaderRowDef="moviesBouquetsDisplayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: moviesBouquetsDisplayedColumns" (click)="bouquetsSelection.toggle(row)"></tr>
                      </table>
                    </div>
                  </mat-card-content>
                </mat-tab>
                <mat-tab label="Series">
                  <mat-card-content class="b-t-1">
                    <div class="table-responsive">
                      <table mat-table [dataSource]="getSeriesBouquetsDatasource" class="w-100">
                        <!-- Table Columns -->
                        <ng-container matColumnDef="select">
                          <th mat-header-cell *matHeaderCellDef class="p-l-0">
                            <mat-checkbox (change)="$event ? masterToggle() : null" [checked]="bouquetsSelection.hasValue() && isAllSelected()"
                              color="primary" [indeterminate]="bouquetsSelection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
                            </mat-checkbox>
                          </th>
                          <td mat-cell *matCellDef="let row" class="p-l-0">
                            <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? bouquetsSelection.toggle(row) : null"
                              color="primary" [checked]="bouquetsSelection.isSelected(row)" [aria-label]="checkboxLabel(row)">
                            </mat-checkbox>
                          </td>
                        </ng-container>
        
                        <ng-container matColumnDef="name">
                          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                            Bouquet Name
                          </th>
                          <td mat-cell *matCellDef="let element" class="mat-body-1">
                            {{ element.bouquetName }}
                          </td>
                        </ng-container>
        
                        <ng-container matColumnDef="series">
                          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                            Series
                          </th>
                          <td mat-cell *matCellDef="let element" class="mat-body-1">
                            {{ element.series }}
                          </td>
                        </ng-container>
        
                        <tr mat-header-row *matHeaderRowDef="seriesBouquetsDisplayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: seriesBouquetsDisplayedColumns" (click)="bouquetsSelection.toggle(row)"></tr>
                      </table>
                    </div>
                  </mat-card-content>
                </mat-tab>
                <mat-tab label="Stations">
                  <mat-card-content class="b-t-1">
                    <div class="table-responsive">
                      <table mat-table [dataSource]="getStationsBouquetsDatasource" class="w-100">
                        <!-- Table Columns -->
                        <ng-container matColumnDef="select">
                          <th mat-header-cell *matHeaderCellDef class="p-l-0">
                            <mat-checkbox (change)="$event ? masterToggle() : null" [checked]="bouquetsSelection.hasValue() && isAllSelected()"
                              color="primary" [indeterminate]="bouquetsSelection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
                            </mat-checkbox>
                          </th>
                          <td mat-cell *matCellDef="let row" class="p-l-0">
                            <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? bouquetsSelection.toggle(row) : null"
                              color="primary" [checked]="bouquetsSelection.isSelected(row)" [aria-label]="checkboxLabel(row)">
                            </mat-checkbox>
                          </td>
                        </ng-container>
        
                        <ng-container matColumnDef="name">
                          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                            Bouquet Name
                          </th>
                          <td mat-cell *matCellDef="let element" class="mat-body-1">
                            {{ element.bouquetName }}
                          </td>
                        </ng-container>
        
                        <ng-container matColumnDef="stations">
                          <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                            Stations
                          </th>
                          <td mat-cell *matCellDef="let element" class="mat-body-1">
                            {{ element.stations }}
                          </td>
                        </ng-container>
        
                        <tr mat-header-row *matHeaderRowDef="stationsBouquetsDisplayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: stationsBouquetsDisplayedColumns" (click)="bouquetsSelection.toggle(row)"></tr>
                      </table>
                    </div>
                  </mat-card-content>
                </mat-tab>
              </mat-tab-group>
            </div>
        
            <!-- Right Side: Selected Bouquets Table -->
            <div class="ml-3" style="flex-basis: 40%; max-width: 40%;">
              <mat-card>
                <!-- <mat-card-header>
                  <mat-card-title>Selected Bouquets</mat-card-title>
                </mat-card-header> -->

                <mat-card-content>
                  <div class="table-responsive">
                    <table mat-table [dataSource]="getSelectedBouquetDatasource" class="w-100">

                      <ng-container matColumnDef="select">
                        <th mat-header-cell *matHeaderCellDef class="p-l-0">
                          <mat-checkbox (change)="$event ? masterToggle() : null" [checked]="bouquetsSelection.hasValue() && isAllSelected()"
                            color="primary" [indeterminate]="bouquetsSelection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
                          </mat-checkbox>
                        </th>
                        <td mat-cell *matCellDef="let row" class="p-l-0">
                          <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? bouquetsSelection.toggle(row) : null"
                            color="primary" [checked]="bouquetsSelection.isSelected(row)" [aria-label]="checkboxLabel(row)">
                          </mat-checkbox>
                        </td>
                      </ng-container>

                      <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Bouquet Name
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          {{ element.bouquetName }}
                        </td>
                      </ng-container>
        
                      <ng-container matColumnDef="streams">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Streams
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          {{ element.streams }}
                        </td>
                      </ng-container>
        
                      <ng-container matColumnDef="movies">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Movies
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          {{ element.movies }}
                        </td>
                      </ng-container>
        
                      <ng-container matColumnDef="series">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Series
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          {{ element.series }}
                        </td>
                      </ng-container>
        
                      <ng-container matColumnDef="stations">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Stations
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          {{ element.stations }}
                        </td>
                      </ng-container>
        
                      <tr mat-header-row *matHeaderRowDef="selectedBouquetsDisplayedColumns"></tr>
                      <tr mat-row *matRowDef="let row; columns: selectedBouquetsDisplayedColumns"></tr>
                    </table>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>
          </div>
        </mat-step>
        

        <mat-step (selectionChange)="onStepChange($event)">
          <ng-template matStepLabel>Finish</ng-template>
          
          <div class="summary-container">
            <!-- <h5>Summary</h5> -->
            
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Preset Name</mat-label>
              <input matInput [value]="editForm.controls['name'].value" disabled>
            </mat-form-field>
          
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Preset Description</mat-label>
              <input matInput [value]="editForm.controls['description'].value" disabled>
            </mat-form-field>
          
            <div class="summary-section">
              <b>Streams: </b>
              <span>{{ getTotalStreamBouquets() }} Bouquets Selected with ({{ getTotalStreams() }}) Streams</span>
              <br>
              <b>Movies: </b>
              <span>{{ getTotalMovieBouquets() }} Bouquets Selected with ({{ getTotalMovies() }}) Movies</span>
              <br>
              <b>Series: </b>
              <span>{{ getTotalSeriesBouquets() }} Bouquets Selected with ({{ getTotalSeries() }}) Series</span>
              <br>
              <b>Stations: </b>
              <span>{{ getTotalStationBouquets() }} Bouquets Selected with ({{ getTotalStations() }}) Stations</span>
            </div>
            <br>
            <!-- 
            <span>
              <span>Edit Form Valid : {{ editForm.valid }}</span>
              <br>
              <span>Loading : {{ loading }}</span>
              <br>
              <span>Finish : {{ isFinishStep }}</span>
            </span> 
            -->
          </div>
          
          
          
        </mat-step>
        

      </mat-stepper>
    </mat-card-content>

  <!-- <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start" animationDuration="300ms">
      <mat-tab label="Details">
          <mat-card-content class="b-t-1">
              <form [formGroup]="editForm" (ngSubmit)="saveDetail()">
                <div class="row">
                  <div class="col-sm-4 d-flex align-items-center">
                    <mat-label class="mat-subtitle-2 f-w-600 d-block m-b-16">Preset Name</mat-label>
                  </div>
                  <div class="col-sm-8">
                    <mat-form-field appearance="outline" class="w-100">
                      <input matInput placeholder="Preset Name" name="presetName" formControlName="name" required />
                    </mat-form-field>
                  </div>
                </div>

                <div class="row">
                  <div class="col-sm-4 d-flex align-items-center">
                    <mat-label class="mat-subtitle-2 f-w-600 d-block m-b-16">Preset Description</mat-label>
                  </div>
                  <div class="col-sm-8">
                    <mat-form-field appearance="outline" class="w-100">
                      <input matInput placeholder="Preset Description" name="presetDescription" formControlName="description" required />
                    </mat-form-field>
                  </div>
                </div>
              </form>
            </mat-card-content>
      </mat-tab>
      <mat-tab label="Bouquets">
        @if(bouquetsLoading){
          <mat-progress-bar mode="query"></mat-progress-bar>
        }
          <mat-card class="">
              <mat-card-content>
                <div class="table-responsive">
                  <table mat-table [dataSource]="bouquetsDataSource" class="w-100">

                    <ng-container matColumnDef="select">
                      <th mat-header-cell *matHeaderCellDef class="p-l-0">
                        <mat-checkbox (change)="$event ? masterToggle() : null" [checked]="bouquetsSelection.hasValue() && isAllSelected()"
                          color="primary" [indeterminate]="bouquetsSelection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
                        </mat-checkbox>
                      </th>
                      <td mat-cell *matCellDef="let row" class="p-l-0">
                        <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? bouquetsSelection.toggle(row) : null"
                          color="primary" [checked]="bouquetsSelection.isSelected(row)" [aria-label]="checkboxLabel(row)">
                        </mat-checkbox>
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="name">
                      <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                        Bouquet Name
                      </th>
                      <td mat-cell *matCellDef="let element" class="mat-body-1">
                        {{ element.bouquetName }}
                      </td>
                    </ng-container>
            
                    <ng-container matColumnDef="streams">
                      <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                        Streams
                      </th>
                      <td mat-cell *matCellDef="let element" class="mat-body-1">
                        {{ element.streams }}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="movies">
                      <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                        Movies
                      </th>
                      <td mat-cell *matCellDef="let element" class="mat-body-1">
                        {{ element.movies }}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="series">
                      <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                        Series
                      </th>
                      <td mat-cell *matCellDef="let element" class="mat-body-1">
                        {{ element.series }}
                      </td>
                    </ng-container>

                     <ng-container matColumnDef="stations">
                      <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                        Stations
                      </th>
                      <td mat-cell *matCellDef="let element" class="mat-body-1">
                        {{ element.stations }}
                      </td>
                    </ng-container>
            
                    <ng-container matColumnDef="budget">
                      <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                        Budget
                      </th>
                      <td mat-cell *matCellDef="let element" class="mat-body-1">
                        ${{ element.budget }}k
                      </td>
                    </ng-container>
            
                    <tr mat-header-row *matHeaderRowDef="bouquetsDisplayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: bouquetsDisplayedColumns" (click)="bouquetsSelection.toggle(row)"></tr>
                  </table>
                </div>
              </mat-card-content>
            </mat-card>
      </mat-tab>
  </mat-tab-group> -->
  
</mat-card>
