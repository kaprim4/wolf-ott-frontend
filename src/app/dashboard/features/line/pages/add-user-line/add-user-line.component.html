<mat-card class="cardWithShadow theme-card">
    <mat-card-header>
        <div class="w-100 d-flex justify-content-between align-items-start">
            <h4 class="mat-subtitle-2 f-s-18 f-w-600 m-b-0">
                <mat-card-title>Add User Line</mat-card-title>
            </h4>
            <div class="text-right">
                <a
                    routerLink="/apps/lines"
                    mat-stroked-button
                    color="warn"
                    class="m-r-10"
                >
                    Cancel
                </a>
                <button
                    mat-raised-button
                    color="primary"
                    (click)="$event.preventDefault(); saveDetail()"
                    [disabled]="addForm.invalid"
                >
                    Save Line
                </button>
            </div>
        </div>
    </mat-card-header>
      
    <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start" animationDuration="0ms">
        <mat-tab label="Details">
            <mat-card-content class="b-t-1">
                <form [formGroup]="addForm" (ngSubmit)="saveDetail()">
                    <div class="row">
                        <div class="col-sm-4 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Username</mat-label>
                        </div>
                        <div class="col-sm-8">
                            <mat-form-field appearance="outline" class="w-100">
                                <input matInput placeholder="Enter Username" formControlName="username" required />
                            </mat-form-field>
                        </div>
                    </div>
                
                    <div class="row">
                        <div class="col-sm-4 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Password</mat-label>
                        </div>
                        <div class="col-sm-8">
                            <mat-form-field appearance="outline" class="w-100">
                                <input matInput type="text" placeholder="Enter Password" formControlName="password" required />
                            </mat-form-field>
                        </div>
                    </div>
                
                    <!-- <div class="row">
                        <div class="col-sm-4 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Owner</mat-label>
                        </div>
                        <div class="col-sm-8">
                            <mat-form-field appearance="outline" class="w-100">
                                <input matInput placeholder="Enter Owner" formControlName="owner" required />
                            </mat-form-field>
                        </div>
                    </div> -->

                    <div class="row">
                        <div class="col-sm-4 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Owner</mat-label>
                        </div>
                        <div class="col-sm-8">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-select [(value)]="selectedOwner" (openedChange)="onOwnersDropdownOpened($event)" required>
                                    <mat-select-trigger>
                                        {{ selectedOwner ? selectedOwner.username : 'Select Owner' }}
                                    </mat-select-trigger>
                                    @if(dropdownOpened){
                                        <mat-option appearance="outline" class="w-100">
                                            <div>
                                                <input
                                                    matInput
                                                    class="w-100"
                                                    type="text"
                                                    placeholder="Search"
                                                    [(ngModel)]="ownerSearchTerm"
                                                    (ngModelChange)="ownersFilterOptions()"
                                                    (click)="$event.stopPropagation()"
                                                />
                                            </div>
                                        </mat-option>
                                    }
                                    <mat-option *ngFor="let owner of filteredOwners" [value]="owner" (click)="$event.stopPropagation()">
                                        {{ owner.username }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </div>
                    
                    <!--                 
                    <div class="row">
                        <div class="col-sm-4 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Package</mat-label>
                        </div>
                        <div class="col-sm-8">
                            <mat-form-field appearance="outline" class="w-100">
                                <input matInput placeholder="Enter Package" formControlName="package" required />
                            </mat-form-field>
                        </div>
                    </div>
                    -->

                    <div class="row">
                        <div class="col-sm-4 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Package</mat-label>
                        </div>
                        <div class="col-sm-8">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-select [(value)]="selectedPackage" (openedChange)="onPackagesDropdownOpened($event)" required>
                                    <mat-select-trigger>
                                        {{ selectedPackage ? selectedPackage.packageName : 'Select Package' }}
                                    </mat-select-trigger>
                                    @if(dropdownOpened){
                                        <mat-option appearance="outline" class="w-100" aria-disabled="true">
                                            <div>
                                                <input
                                                    matInput
                                                    class="w-100"
                                                    type="text"
                                                    placeholder="Search"
                                                    [(ngModel)]="packageSearchTerm"
                                                    (ngModelChange)="packagesFilterOptions()"
                                                    (click)="$event.stopPropagation()"
                                                />
                                            </div>
                                        </mat-option>
                                    }
                                    <mat-option *ngFor="let pkg of filteredPackages" [value]="pkg" (click)="$event.stopPropagation()">
                                        {{ pkg.packageName }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </div>

                    <!-- New Row for Package Cost and Duration -->
                    <div class="row">
                        <div class="col-sm-4 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Package Cost</mat-label>
                        </div>
                        <div class="col-sm-3">
                            <mat-form-field appearance="outline" class="w-100">
                                <input matInput type="number" placeholder="Enter Package Cost" formControlName="packageCost" required />
                            </mat-form-field>
                        </div>
                        <div class="col-sm-2 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Duration</mat-label>
                        </div>
                        <div class="col-sm-3">
                            <mat-form-field appearance="outline" class="w-100">
                                <input matInput placeholder="Enter Duration" formControlName="duration" required />
                            </mat-form-field>
                        </div>
                    </div>
                
                    <!-- New Row for Max Connections and Expiration Date -->
                    <div class="row">
                        <div class="col-sm-4 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Max Connections</mat-label>
                        </div>
                        <div class="col-sm-3">
                            <mat-form-field appearance="outline" class="w-100">
                                <input matInput type="number" placeholder="Enter Max Connections" formControlName="maxConnections" required />
                            </mat-form-field>
                        </div>
                        <div class="col-sm-2 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Expiration Date</mat-label>
                        </div>
                        <div class="col-sm-3">
                            <mat-form-field appearance="outline" class="w-100">
                                <input matInput type="date" placeholder="Enter Expiration Date" formControlName="expirationDate" required />
                            </mat-form-field>
                        </div>
                    </div>
                
                    <div class="row">
                        <div class="col-sm-4 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Reseller Notes</mat-label>
                        </div>
                        <div class="col-sm-8">
                            <mat-form-field appearance="outline" class="w-100">
                                <textarea matInput placeholder="Enter Reseller Notes" rows="4" formControlName="resellerNotes"></textarea>
                            </mat-form-field>
                        </div>
                    </div>
                </form>
                
            </mat-card-content>
        </mat-tab>
        <mat-tab label="Restrictions">
            <!-- Restrictions content here -->
            <mat-card-content class="b-t-1">
                <form [formGroup]="addForm" (ngSubmit)="saveDetail()">
                    <div class="row m-t-12">
                        <div class="col-sm-4 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Allowed IP Addresses</mat-label>
                        </div>
                        <div class="col-sm-8">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Allowed IP's</mat-label>
                                <mat-chip-grid #chipGrid aria-label="Enter fruits">
                                  @for(ip of allowedIps; track ip?.value) {
                                  <mat-chip-row
                                    (removed)="removeAllowedIp(ip?.value)"
                                    [editable]="true"
                                    (edited)="editAllowedIp(ip?.value, $event)"
                                    [aria-description]="'press enter to edit ' + ip?.value"
                                    class="f-s-14"
                                  >
                                    {{ ip.value }}
                                    <button
                                      matChipRemove
                                      [attr.aria-label]="'remove ' + ip?.value"
                                    >
                                      <mat-icon>cancel</mat-icon>
                                    </button>
                                  </mat-chip-row>
                                  }
                  
                                  <input
                                    placeholder="Add ip..."
                                    [matChipInputFor]="chipGrid"
                                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                    [matChipInputAddOnBlur]="addOnBlur"
                                    (matChipInputTokenEnd)="addAllowedIp($event)"
                                  />
                                </mat-chip-grid>
                              </mat-form-field>
                        </div>
                    </div>

                    <div class="row m-t-12">
                        <div class="col-sm-4 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Allowed User-Agents</mat-label>
                        </div>
                        <div class="col-sm-8">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Allowed Agent's</mat-label>
                                <mat-chip-grid #agentChipGrid aria-label="Enter fruits">
                                  @for(agent of allowedAgents; track agent.value) {
                                  <mat-chip-row
                                    (removed)="removeAllowedAgent(agent.value)"
                                    [editable]="true"
                                    (edited)="editAllowedAgent(agent.value, $event)"
                                    [aria-description]="'press enter to edit ' + agent.value"
                                    class="f-s-14"
                                  >
                                    {{ agent.value }}
                                    <button
                                      matChipRemove
                                      [attr.aria-label]="'remove ' + agent.value"
                                    >
                                      <mat-icon>cancel</mat-icon>
                                    </button>
                                  </mat-chip-row>
                                  }
                  
                                  <input
                                    placeholder="Add agent..."
                                    [matChipInputFor]="agentChipGrid"
                                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                    [matChipInputAddOnBlur]="addOnBlur"
                                    (matChipInputTokenEnd)="addAllowedAgent($event)"
                                  />
                                </mat-chip-grid>
                              </mat-form-field>
                        </div>
                    </div>

                    <div class="row m-t-12">
                        <div class="col-sm-4 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Bypass UA Restrictions</mat-label>
                        </div>
                        <div class="col-sm-3">
                            <mat-slide-toggle color="primary"></mat-slide-toggle>
                        </div>
                        <div class="col-sm-2 d-flex align-items-start">
                            <mat-label class="mat-subtitle-2 f-w-600">Lock to ISP</mat-label>
                        </div>
                        <div class="col-sm-3">
                            <mat-slide-toggle color="primary"></mat-slide-toggle>
                        </div>
                    </div>

                    <div class="row m-t-24">
                        <div class="col-sm-4 d-flex align-items-center">
                            <mat-label class="mat-subtitle-2 f-w-600">Current ISP</mat-label>
                        </div>
                        <div class="col-sm-8">
                            <mat-form-field appearance="outline" class="w-100">
                                <input matInput placeholder="Enter ISP" formControlName="package" required />
                            </mat-form-field>
                        </div>
                    </div>
                </form>
            </mat-card-content>
            
        </mat-tab>
        <mat-tab label="Review Purchase">
            <div class="row d-flex justify-content-around align-items-center m-t-24">
                @for(metric of financialMetrics; track metric.title) {
                  <div class="col-lg-3 col-sm-6 d-flex">
                    <mat-card class="cardWithShadow text-center card-fixed-width ">
                      <mat-card-content class="p-24">
                        <div class="d-flex align-items-center">
                          <span
                            class="icon-50 bg-{{ metric.color }} text-white rounded-circle d-flex align-items-center justify-content-center"
                          >
                            <mat-icon class="f-s-24">{{ metric.icon }}</mat-icon>
                          </span>
                          <div class="m-l-12 text-left">
                            <h4 class="mat-subtitle-2 f-s-20 f-w-400 m-t-8">
                              {{ metric.title }}
                            </h4>
                            <h6 class="m-t-4 mat-subtitle-1 f-s-14 f-w-400 m-t-8 text-gray-100">
                              {{ metric.subtitle }}
                            </h6>
                          </div>
                        </div>
                      </mat-card-content>
                    </mat-card>
                  </div>
                }
              </div>
              <mat-card class="">
                <mat-card-content>
                  <div class="table-responsive">
                    <table mat-table [dataSource]="bouquetsDataSource" class="w-100">
                      <!-- Checkbox Column -->
                      <ng-container matColumnDef="select">
                        <th mat-header-cell *matHeaderCellDef class="p-l-0">
                          <mat-checkbox (change)="$event ? masterToggle() : null" [checked]="bouquetsSelection.hasValue() && isAllSelected()"
                            color="primary" [indeterminate]="bouquetsSelection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
                          </mat-checkbox>
                        </th>
                        <td mat-cell *matCellDef="let row" class="p-l-0">
                          <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? bouquetsSelection.toggle(row) : null"
                            color="primary" [checked]="bouquetsSelection.isSelected(row)" [aria-label]="checkboxLabel(row)">
                          </mat-checkbox>
                        </td>
                      </ng-container>

                      <!-- Name Column -->
                      <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Bouquet Name
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          {{ element.bouquetName }}
                        </td>
                      </ng-container>
              
                      <!-- Name Column -->
                      <ng-container matColumnDef="streams">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Streams
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          <!-- {{ element.productName }} -->
                            0
                        </td>
                      </ng-container>

                      <!-- Name Column -->
                      <ng-container matColumnDef="movies">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Movies
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          <!-- {{ element.productName }} -->
                            0
                        </td>
                      </ng-container>

                      <!-- Name Column -->
                      <ng-container matColumnDef="series">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Series
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          <!-- {{ element.productName }} -->
                            0
                        </td>
                      </ng-container>

                       <!-- Name Column -->
                       <ng-container matColumnDef="stations">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Stations
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          <!-- {{ element.productName }} -->
                            0
                        </td>
                      </ng-container>
              
                      <!-- Symbol Column -->
                      <ng-container matColumnDef="budget">
                        <th mat-header-cell *matHeaderCellDef class="f-w-600 mat-subtitle-1 f-s-14">
                          Budget
                        </th>
                        <td mat-cell *matCellDef="let element" class="mat-body-1">
                          ${{ element.budget }}k
                        </td>
                      </ng-container>
              
                      <tr mat-header-row *matHeaderRowDef="bouquetsDisplayedColumns"></tr>
                      <tr mat-row *matRowDef="let row; columns: bouquetsDisplayedColumns" (click)="bouquetsSelection.toggle(row)"></tr>
                    </table>
                  </div>
                </mat-card-content>
              </mat-card>
        </mat-tab>
    </mat-tab-group>
</mat-card>

   